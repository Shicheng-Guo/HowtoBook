library(DSS)
require(bsseq)
setwd("/mnt/bigdata/Genetic/Projects/shg047/rheumatology/RA/NatureCommunication/GSE112658")

RA1 <- read.table("GSM3075569_RA_01.cpgs.tsv.dss", header=F)
RA2 <- read.table("GSM3075570_RA_02.cpgs.tsv.dss", header=F)
RA3 <- read.table("GSM3075571_RA_03.cpgs.tsv.dss", header=F)
RA4 <- read.table("GSM3075572_RA_04.cpgs.tsv.dss", header=F)
RA5 <- read.table("GSM3075573_RA_05.cpgs.tsv.dss", header=F)
RA6 <- read.table("GSM3075574_RA_06.cpgs.tsv.dss", header=F)
RA7 <- read.table("GSM3075575_RA_08.cpgs.tsv.dss", header=F)
RA8 <- read.table("GSM3075576_RA_09.cpgs.tsv.dss", header=F)
RA9 <- read.table("GSM3075577_RA_11.cpgs.tsv.dss", header=F)
OA1 <- read.table("GSM3075578_OA_01.cpgs.tsv.dss", header=F)
OA2 <- read.table("GSM3075579_OA_03.cpgs.tsv.dss", header=F)
OA3 <- read.table("GSM3075580_OA_04.cpgs.tsv.dss", header=F)
OA4 <- read.table("GSM3075581_OA_05.cpgs.tsv.dss", header=F)
OA5 <- read.table("GSM3075582_OA_06.cpgs.tsv.dss", header=F)
OA6 <- read.table("GSM3075583_OA_07.cpgs.tsv.dss", header=F)
OA7 <- read.table("GSM3075584_OA_08.cpgs.tsv.dss", header=F)
OA8 <- read.table("GSM3075585_OA_09.cpgs.tsv.dss", header=F)
OA9 <- read.table("GSM3075586_OA_10.cpgs.tsv.dss", header=F)
OA10 <- read.table("GSM3075587_OA_11.cpgs.tsv.dss", header=F)

ColNames<-c("chr","pos","N","X")
colnames(RA1)<-colnames(RA2)<-colnames(RA3)<-colnames(RA4)<-colnames(RA5)<-colnames(RA6)<-colnames(RA7)<-colnames(RA8)<-colnames(RA9)<-ColNames
colnames(OA1)<-colnames(OA2)<-colnames(OA3)<-colnames(OA4)<-colnames(OA5)<-colnames(OA6)<-colnames(OA7)<-colnames(OA8)<-colnames(OA9)<-colnames(OA10)<-ColNames

save(RA1 ,file="GSM3075569_RA_01.cpgs.tsv.dss.RData")
save(RA2 ,file="GSM3075570_RA_02.cpgs.tsv.dss.RData")
save(RA3 ,file="GSM3075571_RA_03.cpgs.tsv.dss.RData")
save(RA4 ,file="GSM3075572_RA_04.cpgs.tsv.dss.RData")
save(RA5 ,file="GSM3075573_RA_05.cpgs.tsv.dss.RData")
save(RA6 ,file="GSM3075574_RA_06.cpgs.tsv.dss.RData")
save(RA7 ,file="GSM3075575_RA_08.cpgs.tsv.dss.RData")
save(RA8 ,file="GSM3075576_RA_09.cpgs.tsv.dss.RData")
save(RA9 ,file="GSM3075577_RA_11.cpgs.tsv.dss.RData")
save(OA1 ,file="GSM3075578_OA_01.cpgs.tsv.dss.RData")
save(OA2 ,file="GSM3075579_OA_03.cpgs.tsv.dss.RData")
save(OA3 ,file="GSM3075580_OA_04.cpgs.tsv.dss.RData")
save(OA4 ,file="GSM3075581_OA_05.cpgs.tsv.dss.RData")
save(OA5 ,file="GSM3075582_OA_06.cpgs.tsv.dss.RData")
save(OA6 ,file="GSM3075583_OA_07.cpgs.tsv.dss.RData")
save(OA7 ,file="GSM3075584_OA_08.cpgs.tsv.dss.RData")
save(OA8 ,file="GSM3075585_OA_09.cpgs.tsv.dss.RData")
save(OA9 ,file="GSM3075586_OA_10.cpgs.tsv.dss.RData")
save(OA10 ,file="GSM3075587_OA_11.cpgs.tsv.dss.RData")

save.image("WGBS.DSS.RData")

library(DSS)
require(bsseq)
setwd("/mnt/bigdata/Genetic/Projects/shg047/rheumatology/RA/NatureCommunication/GSE112658")


load("GSM3075569_RA_01.cpgs.tsv.dss.RData")
load("GSM3075570_RA_02.cpgs.tsv.dss.RData")
load("GSM3075571_RA_03.cpgs.tsv.dss.RData")
load("GSM3075572_RA_04.cpgs.tsv.dss.RData")
load("GSM3075573_RA_05.cpgs.tsv.dss.RData")
load("GSM3075574_RA_06.cpgs.tsv.dss.RData")
load("GSM3075575_RA_08.cpgs.tsv.dss.RData")
load("GSM3075576_RA_09.cpgs.tsv.dss.RData")
load("GSM3075577_RA_11.cpgs.tsv.dss.RData")

load("GSM3075578_OA_01.cpgs.tsv.dss.RData")
load("GSM3075579_OA_03.cpgs.tsv.dss.RData")
load("GSM3075580_OA_04.cpgs.tsv.dss.RData")
load("GSM3075581_OA_05.cpgs.tsv.dss.RData")
load("GSM3075582_OA_06.cpgs.tsv.dss.RData")
load("GSM3075583_OA_07.cpgs.tsv.dss.RData")
load("GSM3075584_OA_08.cpgs.tsv.dss.RData")
load("GSM3075585_OA_09.cpgs.tsv.dss.RData")
load("GSM3075586_OA_10.cpgs.tsv.dss.RData")
load("GSM3075587_OA_11.cpgs.tsv.dss.RData")

group1=c("R1","R2","R3","R4","R5","R6","R7","R8","R9")
group2=c("N1", "N2","N3","N4","N5","N6","N7","N8","N9","N10")
sampleNames<-c(group1,group2)
ColNames<-c("chr","pos","N","X")
colnames(RA1)<-colnames(RA2)<-colnames(RA3)<-colnames(RA4)<-colnames(RA5)<-colnames(RA6)<-colnames(RA7)<-colnames(RA8)<-colnames(RA9)<-ColNames
colnames(OA1)<-colnames(OA2)<-colnames(OA3)<-colnames(OA4)<-colnames(OA5)<-colnames(OA6)<-colnames(OA7)<-colnames(OA8)<-colnames(OA9)<-colnames(OA10)<-ColNames
dat<-list(RA1,RA2,RA3,RA4,RA5,RA6,RA7,RA8,RA9,OA1,OA2,OA3,OA4,OA5,OA6,OA7,OA8,OA9,OA10)
BSobj <- makeBSseqData(dat,sampleNames)
save.image("WGBS.DSS.RData")
SEQ<-seq(1,31121604,by=20000)
DMRS<-c()
for(i in 1:(length(SEQ)-1)){
dmlTest.sm <- DMLtest(BSobj[SEQ[i]:SEQ[i+1],], group1=group1, group2=group2, smoothing=TRUE)
dmrs <- callDMR(dmlTest.sm, delta=0.1, p.threshold=0.05)
DMRS<-rbind(DMRS,dmrs)
print(i)
}
head(DMRS)
write.table(dmlTest.sm,file="RA-Naturecommnunication.DMC.txt",row.names =F,col.names =T,quote=F,sep="\t")
write.table(DMRS,file="RA-Naturecommnunication.DMR.txt",row.names =F,col.names =T,quote=F,sep="\t")
save.image("WGBS.DSS.RData")


